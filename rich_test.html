<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="reset/css" href="assets/CSS/reset.css">
    <link rel="stylesheet" type="text/css" href="assets/CSS/style.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <title>RICH - TEST PAGE</title>

    <style>






    </style>
</head>

<body>

    <div class="container">

        <h2>Rich's Test Page</h2>

        <form>

            <div id="feature_input" class="input-group">

                <select name="feature" class="custom-select" id="feature_options">
                    <option value="" selected>select a feature:</option>
                    <option value="RSRT">resort</option>
                    <option value="SPA">spa</option>
                    <option value="FT">fort</option>
                    <option value="CTRS">space center</option>
                    <option value="CTRR">religious center</option>
                    <option value="PAL">palace</option>
                    <option value="PGDA">pagoda</option>
                    <option value="CNYN">canyon</option>
                    <option value="PYR">pyramid</option>
                    <option value="PYRS">pyramids</option>
                    <option value="MESU">mesa</option>
                </select>

                <div class="input-group-append">
                    <input id="search_btn" type="submit" class="btn btn-primary" name="submit" value="SEARCH">
                </div>

            </div>

        </form>
        <br>
        <div class="input-group-append">
            <input id="wigle_btn" type="submit" class="btn btn-primary" name="submit" value="WIGLE!">
        </div>

    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script type="text/javascript" src="assets/JS/script.js"></script>

    <script src="assets/JS/selectFeature.js"></script>


    <script>
        // START jQUERY FUNCTION
        // ----------------------------------------------------------------
        $(document).ready(function () {


            // -----------------------------------------------------
            // CODE BELOW SETS THE VALUE OF featureCode WHEN USER CHANGES <select> <option>
            // -----------------------------------------------------

            // THIS IS THE VAR FOR THE FEATURE CODE (like: SPA) THAT WILL BE INSERTED INTO THE geonamesLocationURL
            var featureCode;

            // THIS IS THE FUNCTION THAT GETS THE featureCode VALUE FROM THE <select> <option>
            function getFeatureCode() {

                // create an Array from the value of all <form> input data
                // here, there's just one value, but .serializeArray() gives the best output data format
                var fCode = $("form").serializeArray();

                // set the value of featureCode to be the value of value { value: "SPA" } property of the first object in Array
                featureCode = fCode[0].value;

                // console log's the fCode Array of 1 Object:
                // [{ name: "feature", value: "SPA"}]
                console.log(fCode);

                // console log's the value of "value" in: 
                // [{ name: "feature", value: "SPA"}]
                console.log(fCode[0].value);
            }

            // AND THEN WHENEVER THE USER SELECTS A SEARCH TERM FROM <select>,
            // run getFeatureCode() to update the value of featureCode
            $("select").on("change", getFeatureCode);


            // -----------------------------------------------------
            // CODE BELOW INSERTS THE featureCode INTO THE API STRING,
            // AND MAKES THE AJAX CALL TO THE API, GETTING AN ARRAY OF MATCHING LOCATION OBJECTS
            // -----------------------------------------------------

            // WHEN THE "SEARCH" BUTTON IS CLICKED...
            $("#search_btn").on("click", function () {

                // stop all the default submit form behaviors
                event.preventDefault();

                // THIS IS THE API URL STRING TO CALL FOR A LIST OF LOCATIONS THAT HAVE THE featureCode
                // var geonamesLocationURL = "http://api.geonames.org/searchJSON?featureCode=" + featureCode + "&username=ghostfountain";
                var geonamesLocationURL = "http://api.geonames.org/searchJSON?featureCode=" + featureCode + "&maxRows=1&username=ghostfountain";

                // HERE'S THE FIRST AJAX CALL TO GET LOCATIONS BASED ON FEATURE CODE (SEARCH TERM)
                $.ajax({
                        url: geonamesLocationURL,
                        method: "GET"
                    })
                    .then(function (response) {

                        // console log the JSON Object data that comes back from the API call
                        console.log(response);

                        // get the countryCode, lat, and lng values of each location object
                        var fCountryCode;
                        var fLatitude;
                        var fLongitude;

                        // console log the number of location object we got back from the API
                        // console.log(response.geonames.length);

                        // loop through all location Objects in the Array (response)
                        for (let i = 0; i < response.geonames.length; i++) {

                            // get the countryCode, lat, and lng values of each location object
                            fCountryCode = response.geonames[i].countryCode;
                            // console.log(fCountryCode);
                            fLatitude = response.geonames[i].lat;
                            // console.log(fLatitude);
                            fLongitude = response.geonames[i].lng;
                            // console.log(fLongitude);


                            // API KEY THAT FINDS NEAREST POPULATED AREAS
                            var geonamesNearbyPlaceName = "http://api.geonames.org/findNearbyPlaceNameJSON?lat=" + fLatitude + "&lng=" + fLongitude + "&cities15000&radius=5&style=FULL&maxRows=1&localCountry=true&username=ghostfountain";


                            // Find nearby populated place / reverse geocoding
                            // Webservice Type : REST 
                            // Url : api.geonames.org/findNearbyPlaceName?
                            // Parameters : lat,lng,
                            // lang: language of returned 'name' element (the pseudo language code 'local' will return it in local language),
                            // radius: radius in km (optional), 
                            // maxRows: max number of rows (default 10)
                            // style: SHORT,MEDIUM,LONG,FULL (default = MEDIUM), verbosity of returned xml document
                            // localCountry: in border areas this parameter will restrict the search on the local country, value=true
                            // cities: optional filter parameter with three possible values 'cities1000', 'cities5000','cities15000'. 
                            // See the download readme for further infos
                            // Result : returns the closest populated place (feature class=P) for the lat/lng query as xml document. The unit of the distance element is 'km'. 


                            // HERE'S THE SECOND AJAX CALL TO GETS CLOSEST POPULATED AREAS TO RETURNED LOCATION
                            $.ajax({
                                    url: geonamesNearbyPlaceName,
                                    method: "GET"
                                })
                                .then(function (response) {

                                    // console log the JSON Object data that comes back from the API call
                                    console.log(response);

                                    // get the closest city name near the feature
                                    var cityName = response.geonames[0].name;
                                    // console log the name of the nearby city
                                    console.log(cityName);

                                    // get the country name of the city
                                    var cityCountry = response.geonames[0].countryName;
                                    // console log the name of the nearby city
                                    console.log(cityCountry);

                                    // get the country code of the city
                                    var cityCountryCode = response.geonames[0].countryCode;
                                    // console log the country code of the nearby city
                                    console.log(cityCountryCode);

                                    // get the latitude and longitude of the city
                                    var cityLat = response.geonames[0].lat;
                                    var cityLong = response.geonames[0].lng;
                                    // console log the lat and long of the city
                                    console.log(cityLat);
                                    console.log(cityLong);


                                    // Returns all neighbouring locations worldwide for a given pair of lat,long coordinates.
                                    // Example API call (click, don't be shy):
                                    // https://ezcmd.com/apps/api_ezip_locator/nearby_locations_by_coords/[API_KEY]/[USER_ID]
                                    // GET Parameters:
                                    // Mandatory:
                                    // coords=41.701627,-87.698364 // Latitude and Longitude pair of coordinates separated by comma.
                                    // Optional:
                                    // within=150 // The distance radius to search for neighbouring places within.
                                    // unit=Miles // Either Miles or Km (please mind the upper-case M and K).
                                    // group=place_name // Avoid duplicate results by grouping your results by any of the returned fields. Default grouping is by place_name. Group by id to get all zip codes.
                                    // start=0 // The results are paginated. The start offset. Limit is always 100.


                                    // API KEY THAT FINDS A LIST OF POSTAL CODES BASED ON LAT and LONG COORDINATES
                                    // USE THE LAT AND LONG COORDINATES OF THE FEATURE, OR THE CITY? PROBABLY THE CITY.
                                    // var ezcmdPostalCodes = "https://ezcmd.com/apps/api_geo_postal_codes/nearby_locations_by_coords/866eaf56be3781d02011b80ebd0baef8/354?coords=" + cityLat + "," + cityLong;

                                    // var ezcmdPostalCodes = "https://ezcmd.com/apps/api_geo_postal_codes/nearby_locations_by_coords/866eaf56be3781d02011b80ebd0baef8/354?coords=" + cityLat + "," + cityLong + "&within=10&unit=Km&group=" + cityName;



                                    // =========================================================


                                    // API KEY for POSTAL CODE SEARCH (requires placename or postalcode)
                                    var geonamesFindNearbyPostalCodes = "http://api.geonames.org/findNearbyPostalCodesJSON?lat=" + cityLat + "&lng=" + cityLong + "&radius=10&maxRows=50&style=SHORT&country=" + cityCountryCode + "&localCountry=true&username=ghostfountain"

                                    // This service comes in two flavors. You can either pass the lat/long or a postalcode/placename.
                                    // Webservice Type : REST 
                                    // Url : api.geonames.org/findNearbyPostalCodes?

                                    // Parameters : 
                                    // lat,lng, radius (in km), 
                                    // maxRows (default = 5),
                                    // style (verbosity : SHORT,MEDIUM,LONG,FULL), 
                                    // country (default = all countries), 
                                    // localCountry (in border areas this parameter will restrict the search on the local country, value=true)

                                    // or
                                    // postalcode,country, radius (in Km), maxRows (default = 5)

                                    // Result : returns a list of postalcodes and places for the lat/lng query as xml document. The result is sorted by distance. For Canada the FSA is returned (first 3 characters of full postal code) 

                                    // Example: 
                                    // http://api.geonames.org/findNearbyPostalCodes?lat=47&lng=9&username=demo 
                                    // or 
                                    // api.geonames.org/findNearbyPostalCodes?postalcode=8775&country=CH&radius=10&username=demo
                                    // This service is also available in JSON format : api.geonames.org/findNearbyPostalCodesJSON?postalcode=8775&country=CH&radius=10&username=demo 




                                    // HERE'S THE THIRD AJAX CALL TO EZCMD TO GET POSTAL CODES
                                    // FROM THE LAT AND LONG OF THE NEARBY CITY
                                    $.ajax({
                                            url: geonamesFindNearbyPostalCodes,
                                            method: "GET"
                                        })
                                        .then(function (response) {

                                            // console log the JSON Object data that comes back from the API call
                                            console.log(response);
                                            // console.log for ezcmdPostalCodes postal_codes
                                            // console.log(response.search_results[0].postal_code);
                                            // console.log(response.search_results[1].postal_code);
                                            // console.log(response.search_results[2].postal_code);
                                            // console.log(response.search_results[3].postal_code);
                                            // console.log(response.search_results[4].postal_code);
                                            // console.log(response.search_results[5].postal_code);

                                            // console.log for geonamesFindNearbyPostalCodes postal_codes
                                            // console.log(response.postalCodes[0].postalCode);
                                            // console.log(response.postalCodes[1].postalCode);
                                            // console.log(response.postalCodes[2].postalCode);
                                            // console.log(response.postalCodes[3].postalCode);
                                            // console.log(response.postalCodes[4].postalCode);
                                            // console.log(response.postalCodes[5].postalCode);
                                            // console.log(response.postalCodes[6].postalCode);




                                            // loop through all location Objects in the Array (response)
                                            for (let j = 0; j < response.postalCodes.length; j++) {

                                                console.log(response.postalCodes[j].postalCode);

                                            }


                                        });

                                });
                        }



                    });

                console.log(geonamesLocationURL);
            });




            // WHEN THE "WIGLE!" BUTTON IS CLICKED...
            $("#wigle_btn").on("click", function () {

                // stop all the default submit form behaviors
                event.preventDefault();

                // API KEY for WIGLE /api/v2/stats/regions
                // Get statistics for a specified country, organized by region
                // SEND COUNTRY CODE, GET BACK A LIST OF POSTAL CODES WITH NUMBER OF WIFI HOTSPOTS
                var wigleHotspots = "https://api.wigle.net/api/v2/stats/regions?country=US";

                // HERE'S THE FIRST AJAX CALL TO GET LOCATIONS BASED ON FEATURE CODE (SEARCH TERM)
                $.ajax({
                        headers: {
                            'Authorization': 'Basic ' + btoa('AID544c0365fdcc8c2463ec21d3590bbd23:8891f56fb22400d107dd8ee49d2798ff'),
                        },
                        url: wigleHotspots,
                        method: "GET"
                    })
                    .then(function (response) {

                        console.log(response);

                    });


            });

            // END jQUERY FUNCTION
        });
        // ----------------------------------------------------------------



        // THE API TO SEND THE countryCode TO, AND GET BACK THE NUMBER OF HOTSPOTS IN EACH POSTAL CODE
        // https://api.wigle.net/api/v2/stats/regions?country=US
        // API Name: AID544c0365fdcc8c2463ec21d3590bbd23
        // API Token: 8891f56fb22400d107dd8ee49d2798ff
        // API Name:Token: 
        // AID544c0365fdcc8c2463ec21d3590bbd23:8891f56fb22400d107dd8ee49d2798ff
        // API Name:Token in Base64 ("Encoded for use"): 
        // QUlENTQ0YzAzNjVmZGNjOGMyNDYzZWMyMWQzNTkwYmJkMjM6ODg5MWY1NmZiMjI0MDBkMTA3ZGQ4ZWU0OWQyNzk4ZmY=
        // 
        //
        //
        //
        //
        //
    </script>

</body>

</html>